<aside class="nav">
  <div class="nav__titles">
    <h3>Artisan Admin</h3>
    <h4>üë§ {{authService.currentUser()}}</h4>
  </div>
  
  <ul>
    <li class="menu__item"
    [class.menu__item--active]="isDashboardSelected()"
    (click)="selectDashboard()">Dashboard</li>
    <li class="menu__item"
    [class.menu__item--active]="isPaintingsSelected()"
    (click)="selectPainting()">Pinturas</li>
    <li class="menu__item"
    [class.menu__item--active]="isPricesSelected()"
    (click)="selectPrices()">Precios</li>
    <li class="menu__item"
    [class.menu__item--active]="isContactsSelected()"
    (click)="selectContacts()">Preguntas</li>
    <li class="menu__item"
    [class.menu__item--active]="isCommissionsSelected()"
    (click)="selectCommission()">Comisi√≥nes</li>
  </ul>

  <button class="nav__logout" (click)="logout()">Logout</button>
</aside>

<!-- Token Expiration Warning -->
@if (authService.isTokenExpiringSoon()) {
  <div class="alert alert--error">
    ‚ö†Ô∏è Tu sesi√≥n expirar√° pronto. 
  </div>
}

<main>
  <!-- DASHBOARD -->
  @if (isDashboardSelected()) 
  {
  <div class="option__titles">
    <h2>Dashboard</h2>
    <h3>Bienvenido, {{authService.currentUser()}}! Estas son las novedades de hoy.</h3>
  </div>

  <div class="dashboard-stats">
    <!-- Total Paintings -->
    <div class="box">
      <div class="box__titles">
        <h4>Pinturas Totales</h4>
        <h4>üñºÔ∏è</h4>
      </div>
      <h1>{{paintingsCount()}}</h1>
    </div>

    <!-- Pending Inquiries -->
    <div class="box">
      <div class="box__titles">
        <h4>Preguntas Pendientes</h4>
        <h4>‚ùì</h4>
      </div>
      <h1>{{contactsCount()}}</h1>
    </div>

    <!-- Pending Commissions -->
    <div class="box">
      <div class="box__titles">
        <h4>Peticiones Pendientes</h4>
        <h4>üìß</h4>
      </div>
      <h1>{{commissionsCount()}}</h1>
    </div>
  </div>
  }

  <!-- PAINTING MANAGER -->
  @if (isPaintingsSelected()) 
  {
    <div class="option__titles">
      <h2>Pinturas</h2>
      <h3>Sube, edita, o elimina pinturas de la galer√≠a.</h3>
    </div>

    <div class="box">
      <h2>Subir Nueva Foto</h2>

      <!-- Error Message -->
      @if (uploadError()) {
        <div class="alert alert--error">
          {{ uploadError() }}
        </div>
      }

      <!-- Success Message -->
      @if (uploadSuccess()) {
        <div class="alert alert--success">
          ‚úì Pintura subida exitosamente!
        </div>
      }

      <input type="file" accept="image/*" (change)="onImageSelected($event)"
      #fileInput style="display: none;">
      @if (!imagePreview()) 
      {
        <div class="image-upload" (click)="fileInput.click()">
          <h2>üì∑</h2>
          <span class="image-upload__text">Haz Click Para Subir Una Foto</span>
        </div>
      }
      @else 
      {
        <!-- Shows Preview -->
        <div class="image-upload">
          <img [src]="imagePreview()" alt="Preview" class="image-upload__preview">
          <button type="button" class="image-upload__remove-button" (click)="removeImage()">
            ‚úï Eliminar Imagen
          </button>
        </div>
      }

      <div class="painting__inputs">
        <div class="inputs__input">
          <span class="input__label">Titulo</span>
          <input type="text" class="input__textbox" placeholder="Copa De Vino" [(ngModel)]="paintingForm.title">
        </div>
        <div class="inputs__input">
          <span class="input__label">Precio (MXN)</span>
          <input type="number" class="input__textbox" placeholder="850" [(ngModel)]="paintingForm.price">
        </div>
        <div class="inputs__input">
          <span class="input__label">Altura (Cm)</span>
          <input type="number" class="input__textbox" placeholder="120" [(ngModel)]="paintingForm.height">
        </div>
        <div class="inputs__input">
          <span class="input__label">Width (Cm)</span>
          <input type="number" class="input__textbox" placeholder="90" [(ngModel)]="paintingForm.width">
        </div>
      </div>
      <div class="inputs__input">
        <span class="input__label">Detalles</span>
        <input type="text" class="input__textbox" placeholder="Marco de Vidrio" [(ngModel)]="paintingForm.details">
      </div>

      <button class="add-painting" (click)="uploadPainting()" [disabled]="isUploading()">
        @if (!isUploading()) 
        {
          ‚ûï A√±adir Pintura
        }
        @else 
        {
          Subiendo...
        }
      </button>
    </div> <!-- .box -->

    <div class="box">
      <h2>Pinturas Existentes ({{paintingsCount()}})</h2>

      <table>
        <thead>
          <tr>
            <th>Imagen</th>
            <th>Titulo</th>
            <th>Dimension</th>
            <th>Precio</th>
            <th>Disponibilidad</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          @for(painting of paintings(); track painting.id)
          {
            <tr>
              <td><img [src]="painting.imageURL" [alt]="painting.title" class="table__image"></td>
              <td>({{painting.id}}) {{painting.title}}</td>
              <td>{{painting.height}}cm x {{painting.width}}cm</td>
              <td>${{painting.price | number}}</td>
              <td>@if(painting.available){Disponible}@else{No Disponible}</td>
              <td>
                <div class="table__buttons">
                  <button class="table__edit-button">Editar</button>
                  <button class="table__delete-button"
                  (click)="deletePainting(painting.id)">Borrar</button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  <!-- PRICES MANAGER -->
  @if (isPricesSelected()) 
  {
    <div class="option__titles">
      <h2>Costos de Peticiones</h2>
      <h3>Maneja los precios de las comisi√≥nes y peticiones.</h3>
    </div>
    
    <!-- Sizes -->
    <div class="box">
      <h2>Tama√±os de Base</h2>

      <button class="save-pricing-button" 
      (click)="savePricing()"
      [disabled]="isSavingPricing()">
      @if (!isSavingPricing()) 
      {
        üíæ Guardar Cambios
      } 
      @else 
      {
        Guardando...
      }
      </button>
      <span class="prices__date">
        Ultima Actualizacion: {{pricingService.getLastUpdatedTime() | date:'dd/MM/yyyy'}}
      </span>

      <div class="prices__item">
        <span class="price__label">Peque√±a (Hasta 40cm)</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.sizes.small">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Mediana (40cm - 120cm)</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.sizes.medium">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Grande (120cm - 180cm)</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.sizes.large">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Extra Grande (Mas de 180cm)</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.sizes.extraLarge">
        <span class="price__currency">MXN</span>
      </div>
    </div>
    
    <!-- Stones -->
    <div class="box">
      <h2>Cobertura de Piedras</h2>

      <div class="prices__item">
        <span class="price__label">Cobertura Ligera</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.stones.light">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Cobertura Mediana</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.stones.medium">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Cobertura Pesada</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.stones.heavy">
        <span class="price__currency">MXN</span>
      </div>
    </div>
    
    <!-- Frames -->
    <div class="box">
      <h2>Marcos</h2>

      <div class="prices__item">
        <span class="price__label">Marco de Madera</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.frames.wooden">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Marco de Espejo</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.frames.mirror">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Marco de Madera con LEDs</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.frames.ledWooden">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Marco de Espejo con LEDs</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.frames.ledMirror">
        <span class="price__currency">MXN</span>
      </div>
    </div>
    
    <!-- Features -->
    <div class="box">
      <h2>Caracter√≠sticas Especiales</h2>

      <div class="prices__item">
        <span class="price__label">Mecanismo de Reloj</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.features.clock">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Tiras de "Diamante"</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.features.diamondStrips">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Tachuelas</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.features.studs">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Luces LEDs</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.features.leds">
        <span class="price__currency">MXN</span>
      </div>
    </div>
    
    <!-- Treatments -->
    <div class="box">
      <h2>Tratamientos de Superficie</h2>

      <div class="prices__item">
        <span class="price__label">Resina Epoxica</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.treatments.resin">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Geoda</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.treatments.geode">
        <span class="price__currency">MXN</span>
      </div>
    </div>
    
    <!-- Shipping -->
    <div class="box">
      <h2>Ubicaci√≥n de Env√≠o</h2>

      <div class="prices__item">
        <span class="price__label">Env√≠o Nacional (Desde Mexico A Mexico)</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.shipping.domestic">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Env√≠o a Norteamerica (A Estados Unidos, Canada)</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.shipping.northAmerica">
        <span class="price__currency">MXN</span>
      </div>
      <div class="prices__item">
        <span class="price__label">Env√≠o Internacional</span>
        <input type="number" class="price__input" [(ngModel)]="pricingForm.shipping.international">
        <span class="price__currency">MXN</span>
      </div>
    </div>
  }
</main>